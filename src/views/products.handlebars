<div class="container">
  <h1>Productos</h1>
  
  {{#if products.length}}
    <div class="products-grid">
      {{#each products}}
      <div class="product-card">
        <h3>{{title}}</h3>
        <p class="description">{{description}}</p>
        <p class="price">${{price}}</p>
        <p class="stock">Stock: {{stock}}</p>
        <p class="category">Categoría: {{category}}</p>
        <p class="available">{{#if available}}✅ Disponible{{else}}❌ No disponible{{/if}}</p>
        <div class="actions">
          <a href="/views/products/{{_id}}" class="btn btn-primary">Ver Detalle</a>
          <button onclick="addToCart('{{_id}}')" class="btn btn-secondary">Agregar al Carrito</button>
        </div>
      </div>
      {{/each}}
    </div>
  {{else}}
    <div class="no-products">
      <p>No hay productos disponibles.</p>
    </div>
  {{/if}}

  <!-- Paginación -->
  <div class="pagination">
    {{#if hasPrevPage}}
      <a href="{{prevLink}}" class="btn">Anterior</a>
    {{/if}}
    
    <span>Página {{page}} de {{totalPages}}</span>
    
    {{#if hasNextPage}}
      <a href="{{nextLink}}" class="btn">Siguiente</a>
    {{/if}}
  </div>
</div>

<script>
async function addToCart(productId) {
  try {
    const cartId = 'user-cart-1'; // ID personalizado
    
    const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ quantity: 1 })
    });
    
    if (response.ok) {
      const result = await response.json();
      console.log('Carrito actualizado:', result);
      alert('✅ Producto agregado al carrito exitosamente!');
    } else {
      const error = await response.json();
      console.error('Error del servidor:', error);
      alert(`❌ Error al agregar el producto: ${error.error || 'Error desconocido'}`);
    }
  } catch (error) {
    console.error('Error de red:', error);
    alert('❌ Error de conexión al agregar el producto al carrito');
  }
}
</script>